# Post to Bahamut BBS

發表文章到巴哈姆特 BBS 指定看板。

## 使用方式

```
/post-to-bbs [看板名稱] [分類] [標題] [內容]
```

## 參數

- **看板名稱**（必填）：要發文的看板，例如 `test`, `Chat` 等
- **分類**（選填）：文章分類，例如 `[AI]`, `[測試]`, `[閒聊]` 等。如果不需要分類則填 `-`
- **標題**（必填）：文章標題（不含分類）
- **內容**（必填）：文章內容，可以多行

## 範例

```
/post-to-bbs test [AI] Claude Code 測試發文 這是一篇測試文章\n測試多行內容
/post-to-bbs test - 純標題測試 這是內容
```

## 執行流程

當用戶調用此 skill 時，你需要：

### 1. 確認 BBS 連線狀態
- 使用 `bbs_get_screen` 檢查是否已連線
- 如果未連線，告知用戶需要先連線和登入

### 2. 導航到指定看板
- 使用 `bbs_send` 發送 `s[看板名稱]` 來搜尋看板
- 按 Enter 確認
- 如果出現進板畫面，按空格跳過

### 3. 開始發文
- 使用 `bbs_send_ctrl` 發送 `p` (Ctrl+P) 來開始發文
- 等待進入編輯模式

### 4. 選擇分類
- 如果用戶不需要 BBS 預設分類，直接按 Enter 跳過
- 然後輸入標題：如果有自定義分類，組合成：`[分類] 標題`
- 如果無分類（分類為 `-`），只用標題
- 使用 `bbs_send` 發送標題，然後 `bbs_send_key` 按 Enter

### 4.5. 引用原文（如果是回文）
- 如果是回文（使用 `y` 進入回文模式），系統會詢問「請問要引用原文嗎(Y/N/All/Repost/1-9)？[Y]」
- **預設選 Y**（引用原文），讓討論脈絡更清楚
  - 按 Enter 接受預設值 Y，或輸入 `y` 後按 Enter
- 特殊情況才選 N：
  - 完全不相關的新話題
  - 原文過長且不需要引用
  - 發新主題（使用 Ctrl+P）時不會出現此選項

### 5. 選擇簽名檔
- 按 Enter 選擇 0（不加簽名檔）

### 5.5. 移動游標到引用原文之後（如果有引用）
- **重要**：如果步驟 4.5 選擇了引用原文，進入編輯器時引用內容已在檔案中，但游標在檔案開頭
- **必須先移動游標到檔案最後**，才能在引用原文之後輸入回文
- 移動方法：
  - 使用 `bbs_send_key` 發送 `end` 鍵（跳到當前行末）
  - 然後多次發送 `down` 鍵直到檔案最後
  - 或者使用 Ctrl+End（但 BBS 編輯器可能不支援）
- 正確順序：
  ```
  ※ 引述《作者》之銘言：
  > 原文內容

  你的回文內容  ← 游標應該在這裡輸入

  --
  本文由 Claude Code 發送
  ```
- **如果沒有引用原文（步驟 4.5 選 N），則跳過此步驟**，游標已在正確位置

### 6. 輸入內容（一次性貼上）
- **一次性發送整篇文章**：使用 `bbs_send` 直接發送包含真正換行的完整內容
- 在內容末尾自動添加簽名：
  ```

  --
  本文由 Claude Code 發送
  ```
- **重要**：直接使用包含換行字符的字符串，不需要 `\r` 轉義或 ALT+P
- 範例：
  ```typescript
  const fullContent = `用戶內容第一段

  用戶內容第二段
  - 列表項

  --
  本文由 Claude Code 發送`;

  await bbs_send(fullContent);
  ```

### 7. 儲存並發送
- 使用 `bbs_send_ctrl` 發送 `x` (Ctrl+X) 來儲存
- 發送 `s` 選擇存檔
- 按 Enter 確認
- 確認文章已發送成功（應該顯示「順利貼出佈告」）

### 8. 回報結果
- 按空格回到看板
- 使用 `bbs_get_screen` 取得最終畫面
- 向用戶確認文章已成功發表
- 顯示發文後的畫面內容

## 注意事項

1. **簽名是強制的**：每篇文章都必須自動加上「-- 本文由 Claude Code 發送」簽名，這是不可省略的
2. **錯誤處理**：如果發文過程中遇到錯誤（例如看板不存在、無發文權限），要清楚告知用戶
3. **畫面確認**：每個步驟後都要用 `bbs_get_screen` 確認當前狀態
4. **Big5 編碼**：所有文字都會自動用 Big5 編碼，不需要特別處理
5. **多行內容**：使用 `\n` 來分隔多行內容

## 實作提示

- **一次性貼上**是關鍵：直接用 `bbs_send` 發送包含換行的完整文字即可
- 不需要 ALT+P、不需要 `\r` 轉義、不需要逐行發送
- BBS 編輯器會自動接受多行輸入並正確換行
- BBS 編輯器使用 Ctrl+X 儲存，Ctrl+Q 離開不儲存
- test 板是測試專用，可以自由發文
- 每個步驟之間 MCP 會自動使用智慧等待機制
